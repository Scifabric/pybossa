window.CVM={version:"1.0"};(function(S){var U={init:function(){this.browser=this.searchString(this.dataBrowser)||"An unknown browser";this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"an unknown version";this.OS=this.searchString(this.dataOS)||"an unknown OS"},searchString:function(ad){for(var aa=0;aa<ad.length;aa++){var ab=ad[aa].string;var ac=ad[aa].prop;this.versionSearchString=ad[aa].versionSearch||ad[aa].identity;if(ab){if(ab.indexOf(ad[aa].subString)!=-1){return ad[aa].identity}}else{if(ac){return ad[aa].identity}}}},searchVersion:function(ab){var aa=ab.indexOf(this.versionSearchString);if(aa==-1){return}return parseFloat(ab.substring(aa+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera",versionSearch:"Version"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],dataOS:[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]};U.init();var K=null,B=false,C=[];var h=function(aa,ab){ab(window.confirm(aa))};S.setConfirmFunction=function(ab){var aa=false;h=function(ac,ad){aa=true;ab(ac,function(ae){if(aa){aa=false;ad(ae)}})}};S.debugLogging=false;S.autoUpdate=true;var W=function(aa){alert(aa)};S.setAlertFunction=function(aa){W=aa};var D=function(ab,aa){};S.setGlobalErrorHandler=function(aa){D=aa};var a=function(){},E=function(){},J=function(ab,aa){};S.setGlobalProgressHandler=function(ac,ab,aa){if(ac){J=ac}if(ab){a=ab}if(aa){E=aa}};function f(aa,ac,ab){if(aa){if(aa(ac,ab)){return}}D(ac,ab)}S.startCVMWebAPI=function(ad,ac,ab){if(ac===true){ab=true;ac=null}var aa=function(){if(K==null){K=document.getElementById("cvmweb-api");if(!K){K=document.createElement("embed");if(K==null){f(ac,"Your browser does not support the <embed /> tag!",-101);return}K.type="application/x-cvmweb";K.id="cvmweb-api";K.style.width="1px";K.style.height="1px";document.body.appendChild(K)}console.log("Using CernVM WebAPI "+K.version)}var ae=function(){K.requestDaemonAccess(function(af){ad(new S.WebAPIPlugin(K,af))},function(af){f(ac,"Unable to obtain daemon access: "+z(af),af)})};if(K.version==undefined){if(ab){h("This website is using the CernVM Web API extension, but it doesn't seem to be installed in your browser.\n\nDo you want to install it now?",function(af){if(af){if(U.browser=="Firefox"){window.location="http://labs.wavesoft.gr/micro/res/cvmwebapi-1.2.2.xpi"}else{if(U.browser=="Chrome"){window.location="https://chrome.google.com/webstore/detail/cernvm-web-api/iakpghcolokcngbhjiihjcomioihjnfm"}else{window.location="http://cernvm.cern.ch/portal/webapi"}}}else{f(ac,"Unable to load CernVM WebAPI Plugin. Make sure it's installed!",-100)}})}else{f(ac,"Unable to load CernVM WebAPI Plugin. Make sure it's installed!",-100)}}else{if(ab){if(K.hypervisorName==""){h("You are going to need a hypervisor before you can use this website. Do you allow the CernVM Web API extension to install Oracle VirtualBox for you?",function(ai){if(ai){var ag=true;var af=function(){if(ag){ag=false}else{return}K.removeEventListener("install",af);ae()};var ah=function(aj){if(ag){ag=false}else{return}K.removeEventListener("installError",ah);f(ac,"Unable to install hypervisor!",-103)};K.addEventListener("install",af);K.addEventListener("installError",ah);K.installHypervisor()}else{f(ac,"User denied hypervisor installation!",-102)}})}else{ae()}}else{ae()}}};if(!B){C.push(aa)}else{aa()}};var k=0;var N=1;var Y=2;var n=1;var q=0;var c=-1;var m=-2;var V=-3;var e=-4;var b=-5;var I=-6;var p=-7;var u=-8;var x=-9;var H=-10;var i=-11;var j=-12;var r=-13;var L=-99;var l=-100;var F=0;var d=1;var M=2;var v=3;var w=4;var O=5;var R=6;var T=1;var t=2;var X=4;var o=8;var P=16;var s=1;var Q=2;function A(aa){if(aa==F){return"Closed"}if(aa==d){return"Oppening"}if(aa==M){return"Open"}if(aa==v){return"Starting"}if(aa==w){return"Started"}if(aa==O){return"Error"}if(aa==R){return"Paused"}return"Unknown state "+aa}function z(aa){if(aa==Y){return"Already exists"}if(aa==n){return"Scheduled"}if(aa==q){return"No error"}if(aa==c){return"Creation Error"}if(aa==m){return"Modification Error"}if(aa==V){return"Control Error"}if(aa==e){return"Deletion Error"}if(aa==b){return"Query Error"}if(aa==I){return"I/O Error"}if(aa==p){return"Server/Library Error"}if(aa==u){return"Invalid state for such action"}if(aa==x){return"The requested resource was not found"}if(aa==H){return"Access denied"}if(aa==i){return"The requested action is not supported"}if(aa==j){return"Unable to validate the resource"}if(aa==r){return"The domain is not trusted"}if(aa==L){return"Usage error"}if(aa==l){return"The requested functionality is not implemented"}return"Unknown error #"+aa}S.EventDispatcher=function(aa){this.events={}};S.EventDispatcher.prototype.__fire=function(ab){var aa=Array.prototype.slice.call(arguments),ab=aa.shift();if(S.debugLogging){console.log("Firing",ab,"(",aa,")")}if(this.events[ab]==undefined){return}var ad=this.events[ab];for(var ac=0;ac<ad.length;ac++){ad[ac].apply(this,aa)}};S.EventDispatcher.prototype.addEventListener=function(aa,ab){if(this.events[aa]==undefined){this.events[aa]=[]}this.events[aa].push(ab)};S.EventDispatcher.prototype.removeEventListener=function(aa,ac){if(this.events[aa]==undefined){return}var ab=this.events[aa].indexOf(ac);if(ab<0){return}this.events.splice(ab,1)};var T=1;var t=2;var X=4;var o=8;var Z=function(ab){var aa=0;if(ab.use64bit){aa|=T}if(ab.useBootDisk){aa|=t}if(ab.useGuestAdditions){aa|=X}if(ab.useFloppyIO){aa|=o}if(ab.HVF_HEADFUL){aa|=P}return aa};var g=function(ac){var aa=function(ad){ac.flags=ad},ab=function(){return ac.flags};Object.defineProperties(this,{value:{get:function(){return ab()},set:function(ad){aa(ad)}},use64bit:{get:function(){return((ab()&T)!=0)},set:function(ad){if(ad){aa(ab()|T)}else{aa(ab()&~T)}}},useBootDisk:{get:function(){return((ab()&t)!=0)},set:function(ad){if(ad){aa(ab()|t)}else{aa(ab()&~t)}}},useGuestAdditions:{get:function(){return((ab()&X)!=0)},set:function(ad){if(ad){aa(ab()|X)}else{aa(ab()&~X)}}},useFloppyIO:{get:function(){return((ab()&o)!=0)},set:function(ad){if(ad){aa(ab()|o)}else{aa(ab()&~o)}}},headful:{get:function(){return((ab()&P)!=0)},set:function(ad){if(ad){aa(ab()|P)}else{aa(ab()&~P)}}}})};var G=function(ab){var aa=0;if(ab.suspend){aa|=s}if(ab.autoStart){aa|=Q}return aa};var y=function(ac){var aa=function(ad){ac.daemonFlags=ad},ab=function(){return ac.daemonFlags};Object.defineProperties(this,{value:{get:function(){return ab()},set:function(ad){aa(ad)}},suspend:{get:function(){return((ab()&s)!=0)},set:function(ad){if(ad){aa(ab()|s)}else{aa(ab()&~s)}}},autoStart:{get:function(){return((ab()&Q)!=0)},set:function(ad){if(ad){aa(ab()|Q)}else{aa(ab()&~Q)}}}})};S.WebAPIPlugin=function(aa,ab){S.EventDispatcher.call(this);this.__plugin=aa;this.__daemon=ab;Object.defineProperties(this,{domain:{get:function(){return this.__plugin.domain}}})};S.WebAPIPlugin.prototype=Object.create(S.EventDispatcher.prototype);S.WebAPIPlugin.prototype.hasHypervisor=function(){if(!this.__plugin){return false}return(this.__plugin.version!=undefined)&&(this.__plugin.hypervisorName!="")},S.WebAPIPlugin.prototype.requestSession=function(aa,ac,ab){if(!aa){return false}if(!ac){return false}if(typeof(aa)!="string"){return false}if(typeof(ac)!="function"){return false}if((ab)&&(typeof(ab)!="function")){return false}this.__plugin.requestSafeSession(aa,(function(ah){cSession=ah;if(S.debugLogging){cSession.addEventListener("debug",function(ai){console.log("[Debug] "+ai)})}var af=false;cSession.addEventListener("progress",(function(aj,ai,ak){if(!af){a();af=true}J(Math.round(100*aj/ai),ak);if(aj==ai){E();af=false}}).bind(this));if((ah.state==F)||(ah.state==O)){var ag=true;var ae=(function(){if(ag){ag=false}else{return}ah.removeEventListener("open",ae);ac(new S.WebAPISession(this.__plugin,this.__daemon,ah))}).bind(this);var ad=(function(ai){if(ag){ag=false}else{return}ah.removeEventListener("error",ad);f(ab,"Could not open session: "+z(ai)+".",ai)}).bind(this);ah.addEventListener("open",ae);ah.addEventListener("openError",ad);ah.open()}else{ac(new S.WebAPISession(this.__plugin,this.__daemon,ah))}}).bind(this),function(ad){console.error("RequestSession Error #"+ad);f(ab,"Could not request session: "+z(ad)+".",ad)})};S.WebAPISession=function(ac,ae,ag){S.EventDispatcher.call(this);this.__plugin=ac;this.__daemon=ae;this.__session=ag;this.__valid=true;this.__daemonStatus=false;this.__systemStatus=false;this.autoUpdate=S.autoUpdate;this.__checkDaemonUpdates=function(){var ah=this.__daemon.isRunning;if(ah!=this.__daemonStatus){this.__daemonStatus=ah;this.__fire("daemonStateChange",ah)}if(ah){var ai=this.__daemon.isSystemIdle;if(ai!=this.__systemStatus){this.__systemStatus=ai;this.__fire("systemStateChange",ai)}}};var aa=setInterval((function(){if(this.autoUpdate){this.__session.update()}this.__checkDaemonUpdates()}).bind(this),5000);var ab=undefined;Object.defineProperties(this,{state:{get:function(){if(!this.__valid){return ab}return this.__session.state}},stateName:{get:function(){if(!this.__valid){return ab}return A(this.__session.state)}},ip:{get:function(){if(!this.__valid){return ab}return this.__session.ip}},ram:{get:function(){if(!this.__valid){return ab}return this.__session.ram}},disk:{get:function(){if(!this.__valid){return ab}return this.__session.disk}},apiURL:{get:function(){if(!this.__valid){return ab}return this.__session.apiURL}},rdpURL:{get:function(){if(!this.__valid){return ab}return this.__session.rdpURL}},executionCap:{get:function(){if(!this.__valid){return ab}return this.__session.executionCap},set:function(ah){this.__session.setExecutionCap(ah)}},daemonMinCap:{get:function(){if(!this.__valid){return ab}return this.__session.daemonMinCap},set:function(ah){this.__session.daemonMinCap=ah}},daemonMaxCap:{get:function(){if(!this.__valid){return ab}return this.__session.daemonMaxCap},set:function(ah){this.__session.daemonMaxCap=ah}},daemonControlled:{get:function(){if(!this.__valid){return ab}return this.__session.daemonControlled},set:function(ah){this.__session.daemonControlled=ah;setTimeout((function(){this.__checkDaemonUpdates()}).bind(this),500)}},version:{get:function(){if(!this.__valid){return ab}return((this.__session.flags&t)==0)?this.__session.version:""}},diskURL:{get:function(){if(!this.__valid){return ab}return((this.__session.flags&t)!=0)?this.__session.version:""}},flags:{get:function(){if(!this.__valid){return ab}return new g(this.__session)},set:function(ah){if(typeof(ah)=="number"){this.__session.flags=ah}else{if(typeof(ah)=="object"){this.__session.flags=Z(ah)}}}},daemonFlags:{get:function(){if(!this.__valid){return ab}return new y(this.__session)},set:function(ah){if(typeof(ah)=="number"){this.__session.daemonFlags=ah}else{if(typeof(ah)=="object"){this.__session.daemonFlags=G(ah)}}}}});var af=(function(){clearInterval(aa);this.__valid=false}).bind(this);this.__session.addEventListener("open",(function(){this.__fire("sessionStateChange",M);this.__fire("open")}).bind(this));this.__session.addEventListener("close",(function(){this.__fire("sessionStateChange",F);this.__fire("close");af()}).bind(this));this.__session.addEventListener("start",(function(){this.__fire("sessionStateChange",w);this.__fire("start")}).bind(this));this.__session.addEventListener("stop",(function(){this.__fire("sessionStateChange",M);this.__fire("stop")}).bind(this));this.__session.addEventListener("pause",(function(){this.__fire("sessionStateChange",R);this.__fire("pause")}).bind(this));this.__session.addEventListener("resume",(function(){this.__fire("sessionStateChange",w);this.__fire("resume")}).bind(this));this.__session.addEventListener("hibernate",(function(){this.__fire("sessionStateChange",M);this.__fire("hibernate")}).bind(this));this.__session.addEventListener("error",(function(ai,ah,aj){this.__fire("error",ai,ah,aj)}).bind(this));this.__session.addEventListener("reset",(function(ai,ah,aj){this.__fire("reset")}).bind(this));this.__session.addEventListener("openError",(function(ai,ah){this.__fire("openError",ai,ah)}).bind(this));this.__session.addEventListener("closeError",(function(ai,ah){this.__fire("closeError",ai,ah)}).bind(this));this.__session.addEventListener("startError",(function(ai,ah){this.__fire("startError",ai,ah)}).bind(this));this.__session.addEventListener("stopError",(function(ai,ah){this.__fire("stopError",ai,ah)}).bind(this));this.__session.addEventListener("pauseError",(function(ai,ah){this.__fire("pauseError",ai,ah)}).bind(this));this.__session.addEventListener("resetError",(function(ai,ah){this.__fire("resetError",ai,ah)}).bind(this));this.__session.addEventListener("hibernateError",(function(ai,ah){this.__fire("hibernateError",ai,ah)}).bind(this));this.__session.addEventListener("apiAvailable",(function(ai,ah){this.__fire("apiAvailable",ai,ah)}).bind(this));this.__session.addEventListener("apiUnavailable",(function(){this.__fire("apiUnavailable")}).bind(this));var ad=false;this.__session.addEventListener("progress",(function(ai,ah,aj){if(!ad){this.__fire("progressBegin");a();ad=true}this.__fire("progress",Math.round(100*ai/ah),aj);J(Math.round(100*ai/ah),aj);if(ai==ah){this.__fire("progressEnd");E();ad=false}}).bind(this));setTimeout((function(){this.__fire("daemonStateChange",this.__daemonStatus);this.__fire("systemStateChange",this.__systemStatus);if(this.__session.state!=F){this.__fire("sessionStateChange",this.__session.state)}}).bind(this),1)};S.WebAPISession.prototype=Object.create(S.EventDispatcher.prototype);S.WebAPISession.prototype.start=function(ad,ah,ag){if(!this.__valid){return false}if(typeof(ad)=="function"){ag=ah;ah=ad;ad=false}if(!ad){ad={}}var ab=true,ac=function(){if(ab){ab=false}else{return}if(ah){ah()}aa()},af=function(aj,ai){if(ab){ab=false}else{return}f(ag,"Could not start: "+aj,ai);aa()},aa=(function(){this.__session.removeEventListener("start",ac);this.__session.removeEventListener("startError",af)}).bind(this);this.__session.addEventListener("start",ac);this.__session.addEventListener("startError",af);var ae=this.__session.start(ad);if(ae!=n){f(ag,"Could not start: "+z(ae),ae);return false}this.__checkDaemonUpdates();return true};S.WebAPISession.prototype.stop=function(ag,af){if(!this.__valid){return false}var ab=true,ac=function(){if(ab){ab=false}else{return}if(ag){ag()}aa()},ae=function(ai,ah){if(ab){ab=false}else{return}f(af,"Could not stop: "+ai,ah);aa()},aa=(function(){this.__session.removeEventListener("stop",ac);this.__session.removeEventListener("stopError",ae)}).bind(this);this.__session.addEventListener("stop",ac);this.__session.addEventListener("stopError",ae);var ad=this.__session.stop();if(ad!=n){f(af,"Could not stop: "+z(ad),ad);return false}this.__checkDaemonUpdates();return true};S.WebAPISession.prototype.pause=function(ag,af){if(!this.__valid){return false}var ab=true,ac=function(){if(ab){ab=false}else{return}if(ag){ag()}aa()},ae=function(ai,ah){if(ab){ab=false}else{return}f(af,"Could not pause: "+ai,ah);aa()},aa=(function(){this.__session.removeEventListener("pause",ac);this.__session.removeEventListener("pauseError",ae)}).bind(this);this.__session.addEventListener("pause",ac);this.__session.addEventListener("pauseError",ae);var ad=this.__session.pause();if(ad!=n){f(af,"Could not pause: "+z(ad),ad);return false}this.__checkDaemonUpdates();return true};S.WebAPISession.prototype.resume=function(ag,af){if(!this.__valid){return false}var ab=true,ac=function(){if(ab){ab=false}else{return}if(ag){ag()}aa()},ae=function(ai,ah){if(ab){ab=false}else{return}f(af,"Could not resume: "+ai,ah);aa()},aa=(function(){this.__session.removeEventListener("resume",ac);this.__session.removeEventListener("resumeError",ae)}).bind(this);this.__session.addEventListener("resume",ac);this.__session.addEventListener("resumeError",ae);var ad=this.__session.resume();if(ad!=n){f(af,"Could not resume: "+z(ad),ad);return false}this.__checkDaemonUpdates();return true};S.WebAPISession.prototype.hibernate=function(ag,af){if(!this.__valid){return false}var ab=true,ac=function(){if(ab){ab=false}else{return}if(ag){ag()}aa()},ae=function(ai,ah){if(ab){ab=false}else{return}f(af,"Could not hibernate: "+ai,ah);aa()},aa=(function(){this.__session.removeEventListener("hibernate",ac);this.__session.removeEventListener("hibernateError",ae)}).bind(this);this.__session.addEventListener("hibernate",ac);this.__session.addEventListener("hibernateError",ae);var ad=this.__session.hibernate();if(ad!=n){f(af,"Could not hibernate: "+z(ad),ad);return false}this.__checkDaemonUpdates();return true};S.WebAPISession.prototype.reset=function(ag,af){if(!this.__valid){return false}var ab=true,ac=function(){if(ab){ab=false}else{return}if(ag){ag()}aa()},ae=function(ai,ah){if(ab){ab=false}else{return}f(af,"Could not reset: "+ai,ah);aa()},aa=(function(){this.__session.removeEventListener("reset",ac);this.__session.removeEventListener("resetError",ae)}).bind(this);this.__session.addEventListener("reset",ac);this.__session.addEventListener("resetError",ae);var ad=this.__session.reset();if(ad!=n){f(af,"Could not reset: "+z(ad),ad);return false}this.__checkDaemonUpdates();return true};S.WebAPISession.prototype.close=function(ad){if(!this.__valid){return false}var ab=true,ac=function(){if(ab){ab=false}else{return}if(ad){ad()}aa()},aa=(function(){this.__session.removeEventListener("close",ac)}).bind(this);this.__session.addEventListener("close",ac);this.__session.close();this.__valid=false;this.__checkDaemonUpdates();return true};window.addEventListener("load",function(ab){B=true;for(var aa=0;aa<C.length;aa++){C[aa]()}})})(window.CVM);