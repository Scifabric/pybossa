window.CVM={version:"1.1"};(function(Y){var aa={init:function(){this.browser=this.searchString(this.dataBrowser)||"An unknown browser";this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"an unknown version";this.OS=this.searchString(this.dataOS)||"an unknown OS"},searchString:function(ak){for(var ah=0;ah<ak.length;ah++){var ai=ak[ah].string;var aj=ak[ah].prop;this.versionSearchString=ak[ah].versionSearch||ak[ah].identity;if(ai){if(ai.indexOf(ak[ah].subString)!=-1){return ak[ah].identity}}else{if(aj){return ak[ah].identity}}}},searchVersion:function(ai){var ah=ai.indexOf(this.versionSearchString);if(ah==-1){return}return parseFloat(ai.substring(ah+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera",versionSearch:"Version"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],dataOS:[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]};aa.init();var P=null,E=false,F=[];var k=Y.__globalConfirm=function(ah,ai){if(!ai){if(P!=null){P.confirmCallback(window.confirm(ah))}}else{ai(window.confirm(ah))}};Y.setConfirmFunction=function(ai){var ah=false;k=Y.__globalConfirm=function(aj,ak){ah=true;ai(aj,function(al){if(ah){ah=false;if(!ak){if(P!=null){P.confirmCallback(al)}}else{ak(al)}}})}};Y.debugLogging=false;Y.autoUpdate=true;var ac=function(ah){alert(ah)};Y.setAlertFunction=function(ah){ac=ah};var H=function(ai,ah){};Y.setGlobalErrorHandler=function(ah){H=ah};var a=function(){},J=function(){},N=function(ai,ah){};Y.setGlobalProgressHandler=Y.setGlobalProgressHandlers=function(aj,ai,ah){if(aj){N=aj}if(ai){a=ai}if(ah){J=ah}};var e=0,g=0,d={},O=0,S=function(ah){if(e==0){if(Y.debugLogging){console.log("[Progress] Started")}a()}if(O!=0){clearTimeout(O);O=0}e+=ah;var ai=++g;d["i"+ai]={t:Number(ah),s:0};return ai},ae=function(ah){e-=d["i"+ah].t;delete d["i"+ah];if(e==0){if(O==0){O=setTimeout(function(){O=0;if(Y.debugLogging){console.log("[Progress] Completed")}J()},100)}}},G=function(an,am,al,aj){var ak=0,ai=0;d["i"+aj].s=Number(an);for(var ah in d){if(ah.substr(0,1)=="i"){ak+=d["i"+aj].s;ai+=d["i"+aj].t}}if(Y.debugLogging){console.log("[Progress] "+ak+"/"+ai+": "+al)}N(Math.round(100*ak/ai),al)};function i(ah,aj,ai){if(ah){if(ah(aj,ai)){return}}console.error("[CernVM Web API] Error #"+ai+": "+aj);H(aj,ai)}Y.startCVMWebAPI=function(ak,aj,ai){if(aj===true){ai=true;aj=null}var ah=function(){if(P==null){P=document.getElementById("cvmweb-api");if(!P){P=document.createElement("embed");if(P==null){i(aj,"Your browser does not support the <embed /> tag!",-101);return}P.type="application/x-cvmweb";P.id="cvmweb-api";P.style.width="1px";P.style.height="1px";document.body.appendChild(P)}console.log("Using CernVM WebAPI "+P.version)}var al=function(){P.requestDaemonAccess(function(am){ak(new Y.WebAPIPlugin(P,am))},function(am){i(aj,"Unable to obtain daemon access: "+C(am),am)})};if(P.version==undefined){if(ai){k("This website is using the CernVM Web API extension, but it doesn't seem to be installed in your browser.\n\nDo you want to install it now?",function(am){if(am){if(aa.browser=="Firefox"){window.location="http://labs.wavesoft.gr/micro/res/cvmwebapi-1.2.3.xpi"}else{if(aa.browser=="Chrome"){window.location="https://chrome.google.com/webstore/detail/cernvm-web-api/iakpghcolokcngbhjiihjcomioihjnfm"}else{window.location="http://cernvm.cern.ch/portal/webapi"}}}else{i(aj,"Unable to load CernVM WebAPI Plugin. Make sure it's installed!",-100)}})}else{i(aj,"Unable to load CernVM WebAPI Plugin. Make sure it's installed!",-100)}}else{if(ai){if(P.hypervisorName==""){k("You are going to need a hypervisor before you can use this website. Do you allow the CernVM Web API extension to install Oracle VirtualBox for you?",function(ap){if(ap){var an=true;var am=function(){if(an){an=false}else{return}P.removeEventListener("install",am);al()};var ao=function(aq){if(an){an=false}else{return}P.removeEventListener("installError",ao);i(aj,"Unable to install hypervisor!",-103)};P.addEventListener("install",am);P.addEventListener("installError",ao);P.installHypervisor()}else{i(aj,"User denied hypervisor installation!",-102)}})}else{al()}}else{al()}}};if(!E){F.push(ah)}else{ah()}};var n=0;var T=1;var af=2;var q=1;var t=0;var c=-1;var p=-2;var ab=-3;var h=-4;var b=-5;var M=-6;var s=-7;var x=-8;var A=-9;var L=-10;var l=-11;var m=-12;var u=-13;var Q=-99;var o=-100;var I=0;var f=1;var R=2;var y=3;var z=4;var U=5;var X=6;var Z=1;var w=2;var ad=4;var r=8;var V=16;var v=1;var W=2;function D(ah){if(ah==I){return"Closed"}if(ah==f){return"Oppening"}if(ah==R){return"Open"}if(ah==y){return"Starting"}if(ah==z){return"Started"}if(ah==U){return"Error"}if(ah==X){return"Paused"}return"Unknown state "+ah}function C(ah){if(ah==af){return"Already exists"}if(ah==q){return"Scheduled"}if(ah==t){return"No error"}if(ah==c){return"Creation Error"}if(ah==p){return"Modification Error"}if(ah==ab){return"Control Error"}if(ah==h){return"Deletion Error"}if(ah==b){return"Query Error"}if(ah==M){return"I/O Error"}if(ah==s){return"Server/Library Error"}if(ah==x){return"Invalid state for such action"}if(ah==A){return"The requested resource was not found"}if(ah==L){return"Access denied"}if(ah==l){return"The requested action is not supported"}if(ah==m){return"Unable to validate the resource"}if(ah==u){return"The domain is not trusted"}if(ah==Q){return"Usage error"}if(ah==o){return"The requested functionality is not implemented"}return"Unknown error #"+ah}Y.EventDispatcher=function(ah){this.events={}};Y.EventDispatcher.prototype.__fire=function(ai){var ah=Array.prototype.slice.call(arguments),ai=ah.shift();if(Y.debugLogging){console.log("Firing",ai,"(",ah,")")}if(this.events[ai]==undefined){return}var ak=this.events[ai];for(var aj=0;aj<ak.length;aj++){ak[aj].apply(this,ah)}};Y.EventDispatcher.prototype.addEventListener=function(ah,ai){if(this.events[ah]==undefined){this.events[ah]=[]}this.events[ah].push(ai)};Y.EventDispatcher.prototype.removeEventListener=function(ah,aj){if(this.events[ah]==undefined){return}var ai=this.events[ah].indexOf(aj);if(ai<0){return}this.events.splice(ai,1)};var Z=1;var w=2;var ad=4;var r=8;var ag=function(ai){var ah=0;if(ai.use64bit){ah|=Z}if(ai.useBootDisk){ah|=w}if(ai.useGuestAdditions){ah|=ad}if(ai.useFloppyIO){ah|=r}if(ai.HVF_HEADFUL){ah|=V}return ah};var j=function(aj){var ah=function(ak){aj.flags=ak},ai=function(){return aj.flags};Object.defineProperties(this,{value:{get:function(){return ai()},set:function(ak){ah(ak)}},use64bit:{get:function(){return((ai()&Z)!=0)},set:function(ak){if(ak){ah(ai()|Z)}else{ah(ai()&~Z)}}},useBootDisk:{get:function(){return((ai()&w)!=0)},set:function(ak){if(ak){ah(ai()|w)}else{ah(ai()&~w)}}},useGuestAdditions:{get:function(){return((ai()&ad)!=0)},set:function(ak){if(ak){ah(ai()|ad)}else{ah(ai()&~ad)}}},useFloppyIO:{get:function(){return((ai()&r)!=0)},set:function(ak){if(ak){ah(ai()|r)}else{ah(ai()&~r)}}},headful:{get:function(){return((ai()&V)!=0)},set:function(ak){if(ak){ah(ai()|V)}else{ah(ai()&~V)}}}})};var K=function(ai){var ah=0;if(ai.suspend){ah|=v}if(ai.autoStart){ah|=W}return ah};var B=function(aj){var ah=function(ak){aj.daemonFlags=ak},ai=function(){return aj.daemonFlags};Object.defineProperties(this,{value:{get:function(){return ai()},set:function(ak){ah(ak)}},suspend:{get:function(){return((ai()&v)!=0)},set:function(ak){if(ak){ah(ai()|v)}else{ah(ai()&~v)}}},autoStart:{get:function(){return((ai()&W)!=0)},set:function(ak){if(ak){ah(ai()|W)}else{ah(ai()&~W)}}}})};Y.WebAPIPlugin=function(ai,ak){Y.EventDispatcher.call(this);this.__plugin=ai;this.__daemon=ak;Object.defineProperties(this,{domain:{get:function(){return this.__plugin.domain}}});var aj=false,ah=0;this.__plugin.addEventListener("installProgress",(function(am,al,an){if(!aj){this.__fire("installProgressBegin");ah=S(al);aj=true}this.__fire("installProgress",Math.round(100*am/al),an);G(am,al,an,ah);if(am==al){this.__fire("installProgressEnd");aj=false}}).bind(this));this.__plugin.addEventListener("install",(function(){this.__fire("installCompleted");ae(ah)}).bind(this));this.__plugin.addEventListener("installError",(function(){this.__fire("installError");ae(ah)}).bind(this))};Y.WebAPIPlugin.prototype=Object.create(Y.EventDispatcher.prototype);Y.WebAPIPlugin.prototype.hasHypervisor=function(){if(!this.__plugin){return false}return(this.__plugin.version!=undefined)&&(this.__plugin.hypervisorName!="")},Y.WebAPIPlugin.prototype.requestSession=function(aj,am,ak){if(!aj){return false}if(!am){return false}if(typeof(aj)!="string"){return false}if(typeof(am)!="function"){return false}if((ak)&&(typeof(ak)!="function")){return false}var ai=false,ah=0,al=(function(ao,an,ap){if(!ai){ah=S(an);ai=true}G(ao,an,ap,ah);if(ao==an){ae(ah);ai=false}}).bind(this);this.__plugin.requestSafeSession(aj,(function(aq){cSession=aq;if(Y.debugLogging){cSession.addEventListener("debug",function(ar){console.log("[Debug] "+ar)})}cSession.addEventListener("progress",al);if((aq.state==I)||(aq.state==U)){var ap=true;var ao=(function(){if(ap){ap=false}else{return}aq.removeEventListener("open",ao);am(new Y.WebAPISession(this.__plugin,this.__daemon,aq))}).bind(this);var an=(function(at,ar){if(ap){ap=false}else{return}aq.removeEventListener("error",an);i(ak,"Could not open session: "+C(ar)+".",ar)}).bind(this);aq.addEventListener("open",ao);aq.addEventListener("openError",an);aq.open()}else{am(new Y.WebAPISession(this.__plugin,this.__daemon,aq))}}).bind(this),function(an){console.error("RequestSession Error #"+an);i(ak,"Could not request session: "+C(an)+".",an)},al)};Y.WebAPISession=function(aj,al,an){Y.EventDispatcher.call(this);this.__plugin=aj;this.__daemon=al;this.__session=an;this.__valid=true;this.__daemonStatus=false;this.__systemStatus=false;this.autoUpdate=Y.autoUpdate;this.__checkDaemonUpdates=function(){var ao=this.__daemon.isRunning;if(ao!=this.__daemonStatus){this.__daemonStatus=ao;this.__fire("daemonStateChange",ao)}if(ao){var ap=this.__daemon.isSystemIdle;if(ap!=this.__systemStatus){this.__systemStatus=ap;this.__fire("systemStateChange",ap)}}};var ah=setInterval((function(){if(this.autoUpdate){this.__session.update()}this.__checkDaemonUpdates()}).bind(this),5000);var ai=undefined;Object.defineProperties(this,{state:{get:function(){if(!this.__valid){return ai}return this.__session.state}},stateName:{get:function(){if(!this.__valid){return ai}return D(this.__session.state)}},ip:{get:function(){if(!this.__valid){return ai}return this.__session.ip}},ram:{get:function(){if(!this.__valid){return ai}return this.__session.ram}},disk:{get:function(){if(!this.__valid){return ai}return this.__session.disk}},apiURL:{get:function(){if(!this.__valid){return ai}return this.__session.apiURL}},rdpURL:{get:function(){if(!this.__valid){return ai}return this.__session.rdpURL}},executionCap:{get:function(){if(!this.__valid){return ai}return this.__session.executionCap},set:function(ao){this.__session.setExecutionCap(ao)}},daemonMinCap:{get:function(){if(!this.__valid){return ai}return this.__session.daemonMinCap},set:function(ao){this.__session.daemonMinCap=ao}},daemonMaxCap:{get:function(){if(!this.__valid){return ai}return this.__session.daemonMaxCap},set:function(ao){this.__session.daemonMaxCap=ao}},daemonControlled:{get:function(){if(!this.__valid){return ai}return this.__session.daemonControlled},set:function(ao){this.__session.daemonControlled=ao;setTimeout((function(){this.__checkDaemonUpdates()}).bind(this),500)}},version:{get:function(){if(!this.__valid){return ai}return((this.__session.flags&w)==0)?this.__session.version:""}},diskURL:{get:function(){if(!this.__valid){return ai}return((this.__session.flags&w)!=0)?this.__session.version:""}},flags:{get:function(){if(!this.__valid){return ai}return new j(this.__session)},set:function(ao){if(typeof(ao)=="number"){this.__session.flags=ao}else{if(typeof(ao)=="object"){this.__session.flags=ag(ao)}}}},daemonFlags:{get:function(){if(!this.__valid){return ai}return new B(this.__session)},set:function(ao){if(typeof(ao)=="number"){this.__session.daemonFlags=ao}else{if(typeof(ao)=="object"){this.__session.daemonFlags=K(ao)}}}}});var am=(function(){clearInterval(ah);this.__valid=false}).bind(this);this.__session.addEventListener("open",(function(){this.__fire("sessionStateChange",R);this.__fire("open")}).bind(this));this.__session.addEventListener("close",(function(){this.__fire("sessionStateChange",I);this.__fire("close");am()}).bind(this));this.__session.addEventListener("start",(function(){this.__fire("sessionStateChange",z);this.__fire("start")}).bind(this));this.__session.addEventListener("stop",(function(){this.__fire("sessionStateChange",R);this.__fire("stop")}).bind(this));this.__session.addEventListener("pause",(function(){this.__fire("sessionStateChange",X);this.__fire("pause")}).bind(this));this.__session.addEventListener("resume",(function(){this.__fire("sessionStateChange",z);this.__fire("resume")}).bind(this));this.__session.addEventListener("hibernate",(function(){this.__fire("sessionStateChange",R);this.__fire("hibernate")}).bind(this));this.__session.addEventListener("error",(function(ap,ao,aq){this.__fire("error",ap,ao,aq)}).bind(this));this.__session.addEventListener("reset",(function(ap,ao,aq){this.__fire("reset")}).bind(this));this.__session.addEventListener("openError",(function(ap,ao){this.__fire("openError",ap,ao)}).bind(this));this.__session.addEventListener("closeError",(function(ap,ao){this.__fire("closeError",ap,ao)}).bind(this));this.__session.addEventListener("startError",(function(ap,ao){this.__fire("startError",ap,ao)}).bind(this));this.__session.addEventListener("stopError",(function(ap,ao){this.__fire("stopError",ap,ao)}).bind(this));this.__session.addEventListener("pauseError",(function(ap,ao){this.__fire("pauseError",ap,ao)}).bind(this));this.__session.addEventListener("resetError",(function(ap,ao){this.__fire("resetError",ap,ao)}).bind(this));this.__session.addEventListener("hibernateError",(function(ap,ao){this.__fire("hibernateError",ap,ao)}).bind(this));this.__session.addEventListener("apiAvailable",(function(ap,ao){this.__fire("apiAvailable",ap,ao)}).bind(this));this.__session.addEventListener("apiUnavailable",(function(){this.__fire("apiUnavailable")}).bind(this));var ak=false;this.__session.addEventListener("progress",(function(ap,ao,aq){if(!ak){this.__fire("progressBegin");ak=true}this.__fire("progress",Math.round(100*ap/ao),aq);if(ap==ao){this.__fire("progressEnd");ak=false}}).bind(this));setTimeout((function(){this.__fire("daemonStateChange",this.__daemonStatus);this.__fire("systemStateChange",this.__systemStatus);if(this.__session.state!=I){this.__fire("sessionStateChange",this.__session.state)}}).bind(this),1)};Y.WebAPISession.prototype=Object.create(Y.EventDispatcher.prototype);Y.WebAPISession.prototype.start=function(ak,ao,an){if(!this.__valid){return false}if(typeof(ak)=="function"){an=ao;ao=ak;ak=false}if(!ak){ak={}}var ai=true,aj=function(){if(ai){ai=false}else{return}if(ao){ao()}ah()},am=function(aq,ap){if(ai){ai=false}else{return}i(an,"Could not start: "+aq,ap);ah()},ah=(function(){this.__session.removeEventListener("start",aj);this.__session.removeEventListener("startError",am)}).bind(this);this.__session.addEventListener("start",aj);this.__session.addEventListener("startError",am);var al=this.__session.start(ak);if(al!=q){i(an,"Could not start: "+C(al),al);return false}this.__checkDaemonUpdates();return true};Y.WebAPISession.prototype.stop=function(an,am){if(!this.__valid){return false}var ai=true,aj=function(){if(ai){ai=false}else{return}if(an){an()}ah()},al=function(ap,ao){if(ai){ai=false}else{return}i(am,"Could not stop: "+ap,ao);ah()},ah=(function(){this.__session.removeEventListener("stop",aj);this.__session.removeEventListener("stopError",al)}).bind(this);this.__session.addEventListener("stop",aj);this.__session.addEventListener("stopError",al);var ak=this.__session.stop();if(ak!=q){i(am,"Could not stop: "+C(ak),ak);return false}this.__checkDaemonUpdates();return true};Y.WebAPISession.prototype.pause=function(an,am){if(!this.__valid){return false}var ai=true,aj=function(){if(ai){ai=false}else{return}if(an){an()}ah()},al=function(ap,ao){if(ai){ai=false}else{return}i(am,"Could not pause: "+ap,ao);ah()},ah=(function(){this.__session.removeEventListener("pause",aj);this.__session.removeEventListener("pauseError",al)}).bind(this);this.__session.addEventListener("pause",aj);this.__session.addEventListener("pauseError",al);var ak=this.__session.pause();if(ak!=q){i(am,"Could not pause: "+C(ak),ak);return false}this.__checkDaemonUpdates();return true};Y.WebAPISession.prototype.resume=function(an,am){if(!this.__valid){return false}var ai=true,aj=function(){if(ai){ai=false}else{return}if(an){an()}ah()},al=function(ap,ao){if(ai){ai=false}else{return}i(am,"Could not resume: "+ap,ao);ah()},ah=(function(){this.__session.removeEventListener("resume",aj);this.__session.removeEventListener("resumeError",al)}).bind(this);this.__session.addEventListener("resume",aj);this.__session.addEventListener("resumeError",al);var ak=this.__session.resume();if(ak!=q){i(am,"Could not resume: "+C(ak),ak);return false}this.__checkDaemonUpdates();return true};Y.WebAPISession.prototype.hibernate=function(an,am){if(!this.__valid){return false}var ai=true,aj=function(){if(ai){ai=false}else{return}if(an){an()}ah()},al=function(ap,ao){if(ai){ai=false}else{return}i(am,"Could not hibernate: "+ap,ao);ah()},ah=(function(){this.__session.removeEventListener("hibernate",aj);this.__session.removeEventListener("hibernateError",al)}).bind(this);this.__session.addEventListener("hibernate",aj);this.__session.addEventListener("hibernateError",al);var ak=this.__session.hibernate();if(ak!=q){i(am,"Could not hibernate: "+C(ak),ak);return false}this.__checkDaemonUpdates();return true};Y.WebAPISession.prototype.reset=function(an,am){if(!this.__valid){return false}var ai=true,aj=function(){if(ai){ai=false}else{return}if(an){an()}ah()},al=function(ap,ao){if(ai){ai=false}else{return}i(am,"Could not reset: "+ap,ao);ah()},ah=(function(){this.__session.removeEventListener("reset",aj);this.__session.removeEventListener("resetError",al)}).bind(this);this.__session.addEventListener("reset",aj);this.__session.addEventListener("resetError",al);var ak=this.__session.reset();if(ak!=q){i(am,"Could not reset: "+C(ak),ak);return false}this.__checkDaemonUpdates();return true};Y.WebAPISession.prototype.close=function(ak){if(!this.__valid){return false}var ai=true,aj=function(){if(ai){ai=false}else{return}if(ak){ak()}ah()},ah=(function(){this.__session.removeEventListener("close",aj)}).bind(this);this.__session.addEventListener("close",aj);this.__session.close();this.__valid=false;this.__checkDaemonUpdates();return true};window.addEventListener("load",function(ai){E=true;for(var ah=0;ah<F.length;ah++){F[ah]()}})})(window.CVM);